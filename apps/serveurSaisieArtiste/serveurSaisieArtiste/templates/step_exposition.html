<!-- templates/step_exposition.html -->
{% extends "base.html" %}

{% block title %}Cr√©er une annonce d'exposition{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card shadow">
            <div class="card-body">
                <h2 class="card-title text-danger">üì¢ Cr√©ation d'annonce d'exposition</h2>

                <div class="alert alert-info">
                    Cette √©tape g√©n√®re une annonce d'exposition professionnelle √† partir d'une page web de description et de liens additionnels.
                </div>

                <form method="POST" action="{{ url_for('create_exposition_announcement') }}" id="expositionForm">
                    <div class="mb-3">
                        <label for="description_url" class="form-label">
                            <strong>URL de la page de description de l'exposition</strong> <span class="text-danger">*</span>
                        </label>
                        <input
                            type="url"
                            class="form-control"
                            id="description_url"
                            name="description_url"
                            required
                            placeholder="https://example.com/exposition-details"
                        >
                        <div class="form-text">
                            URL de la page web contenant les d√©tails de l'exposition (dates, lieu, artistes, etc.)
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="additional_links" class="form-label">
                            <strong>Liens additionnels</strong> (optionnel)
                        </label>
                        <textarea
                            class="form-control"
                            id="additional_links"
                            name="additional_links"
                            rows="4"
                            placeholder="https://example.com/artiste1&#10;https://example.com/artiste2&#10;https://example.com/galerie"
                        ></textarea>
                        <div class="form-text">
                            Ajoutez des liens suppl√©mentaires (un par ligne ou s√©par√©s par des virgules) : pages des artistes, galerie, √©v√©nements li√©s, etc.
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="prompt_template" class="form-label">
                            <strong>Template de prompt pour la g√©n√©ration</strong>
                            <button type="button" class="btn btn-sm btn-outline-info" onclick="resetPrompt()">
                                üîÑ R√©initialiser au d√©faut
                            </button>
                        </label>
                        <textarea
                            class="form-control font-monospace small"
                            id="prompt_template"
                            name="prompt_template"
                            rows="12"
                        >{{ default_prompt }}</textarea>
                        <div class="form-text">
                            Personnalisez le prompt utilis√© pour g√©n√©rer l'annonce. Utilisez <code>{description_url}</code> et <code>{additional_links}</code> comme variables.
                        </div>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-danger btn-lg">
                            üì¢ G√©n√©rer l'annonce d'exposition
                        </button>
                        <a href="{{ url_for('menu') }}" class="btn btn-outline-secondary">
                            ‚Üê Retour au menu
                        </a>
                    </div>
                </form>

                <!-- Section d'aide -->
                <div class="mt-4">
                    <button class="btn btn-outline-info btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#helpSection">
                        üí° Afficher l'aide
                    </button>
                    <div class="collapse mt-2" id="helpSection">
                        <div class="card card-body bg-light">
                            <h6>Comment utiliser cette fonctionnalit√© :</h6>
                            <ol class="small">
                                <li><strong>URL de description :</strong> Fournissez l'URL de la page officielle de l'exposition contenant toutes les informations (dates, lieu, horaires, artistes pr√©sent√©s, etc.)</li>
                                <li><strong>Liens additionnels :</strong> Ajoutez des URLs compl√©mentaires pour enrichir l'analyse (pages Wikidata des artistes, site de la galerie, articles de presse, etc.)</li>
                                <li><strong>Template de prompt :</strong> Personnalisez le style et le contenu de l'annonce en modifiant le prompt. Le syst√®me utilisera ce template pour g√©n√©rer le texte final.</li>
                            </ol>

                            <h6 class="mt-3">L'annonce g√©n√©r√©e inclura :</h6>
                            <ul class="small">
                                <li>Un titre accrocheur</li>
                                <li>Une introduction engageante sur l'exposition</li>
                                <li>Les informations pratiques (dates, lieu, horaires)</li>
                                <li>Une description des ≈ìuvres ou artistes pr√©sent√©s</li>
                                <li>Un appel √† l'action pour inciter les visiteurs</li>
                            </ul>

                            <h6 class="mt-3">Variables disponibles dans le prompt :</h6>
                            <ul class="small mb-0">
                                <li><code>{description_url}</code> : L'URL de la page de description principale</li>
                                <li><code>{additional_links}</code> : Liste des liens additionnels fournis</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Exemples -->
                <div class="mt-4">
                    <h5>Exemples de prompts :</h5>
                    <div class="accordion" id="promptExamples">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#example1">
                                    Style formel/institutionnel
                                </button>
                            </h2>
                            <div id="example1" class="accordion-collapse collapse" data-bs-parent="#promptExamples">
                                <div class="accordion-body small">
                                    <pre class="mb-0"><code>R√©digez une annonce d'exposition au ton formel et institutionnel bas√©e sur {description_url}.

Structure attendue :
1. Titre officiel de l'exposition
2. Pr√©sentation institutionnelle (mus√©e/galerie)
3. Description acad√©mique des ≈ìuvres
4. Informations pratiques d√©taill√©es
5. Contact et r√©servations

Sources additionnelles : {additional_links}

Ton : acad√©mique, pr√©cis, informatif
Longueur : 400-600 mots</code></pre>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#example2">
                                    Style promotionnel/marketing
                                </button>
                            </h2>
                            <div id="example2" class="accordion-collapse collapse" data-bs-parent="#promptExamples">
                                <div class="accordion-body small">
                                    <pre class="mb-0"><code>Cr√©ez une annonce promotionnelle captivante pour une exposition bas√©e sur {description_url}.

Objectif : attirer un large public et cr√©er l'√©v√©nement

√âl√©ments √† inclure :
- Titre impactant avec √©mojis
- Accroche qui intrigue et s√©duit
- Mise en avant des pi√®ces phares
- T√©moignages ou citations marquantes
- Call-to-action √©nergique
- Hashtags pertinents

Sources : {additional_links}

Ton : dynamique, enthousiaste, accessible
Longueur : 250-400 mots</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
const defaultPrompt = {{ default_prompt|tojson }};

function resetPrompt() {
    document.getElementById('prompt_template').value = defaultPrompt;
}

// Validation du formulaire
document.getElementById('expositionForm').addEventListener('submit', function(e) {
    const url = document.getElementById('description_url').value;

    try {
        new URL(url);
    } catch (error) {
        e.preventDefault();
        alert('Erreur : L\'URL de description n\'est pas valide.\n\nVeuillez entrer une URL compl√®te (ex: https://example.com/exposition)');
        return false;
    }
});
</script>
{% endblock %}