<!-- templates/images_result.html -->
{% extends "base.html" %}

{% block title %}Liste d'images - {{ result.get('label', 'Artiste') }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <!-- Boutons d'action en haut -->
        {% if task_id %}
        <div class="card shadow mb-3 bg-light">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">🚀 Étapes suivantes</h5>
                    <div>
                        <a href="{{ url_for('step_gallery_upload_prefilled', task_id=task_id) }}" class="btn btn-success me-2">
                            📤 Uploader vers la galerie
                        </a>
                        <a href="{{ url_for('step_wordpress_prefilled', task_id=task_id) }}" class="btn btn-warning">
                            📝 Créer post WordPress
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <div class="card shadow">
            <div class="card-body">
                <div class="text-center mb-4">
                    <div class="text-info">
                        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="currentColor" class="bi bi-images" viewBox="0 0 16 16">
                            <path d="M4.502 9a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3"/>
                            <path d="M14.002 13a2 2 0 0 1-2 2h-10a2 2 0 0 1-2-2V5A2 2 0 0 1 2 3a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v8a2 2 0 0 1-1.998 2M14 2H4a1 1 0 0 0-1 1h9.002a2 2 0 0 1 2 2v7A1 1 0 0 0 15 11V3a1 1 0 0 0-1-1M2.002 4a1 1 0 0 0-1 1v8l2.646-2.354a.5.5 0 0 1 .63-.062l2.66 1.773 3.71-3.71a.5.5 0 0 1 .577-.094l1.777 1.947V5a1 1 0 0 0-1-1z"/>
                        </svg>
                    </div>
                    <h2 class="card-title text-info mt-3">🖼️ Liste d'images générée</h2>
                    <p class="text-muted">{{ result.get('label', 'N/A') }} ({{ result.get('qid', 'N/A') }})</p>
                </div>

                {% if result.get('json_result') %}
                <!-- Statistiques -->
                <div class="alert alert-success">
                    <strong>{{ result.json_result.get('total_found', 0) }} image(s) trouvée(s)</strong> sur Wikimedia Commons
                </div>

                <!-- Liste des images -->
                {% if result.json_result.get('images') %}
                <div class="card mb-3">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">📋 Images trouvées</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            {% for image in result.json_result.images[:6] %}
                            <div class="col-md-4 mb-3">
                                <div class="card h-100">
                                    <img src="{{ image.get('url', '') }}" class="card-img-top" alt="{{ image.get('titre_fr', 'Image') }}" style="height: 200px; object-fit: cover;" onerror="this.src='https://via.placeholder.com/400x200?text=Image+non+disponible'">
                                    <div class="card-body">
                                        <h6 class="card-title">{{ image.get('titre_fr', 'Sans titre') }}</h6>
                                        <p class="card-text small text-muted">{{ image.get('source', 'Source inconnue') }}</p>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% if result.json_result.images|length > 6 %}
                        <p class="text-muted text-center">... et {{ result.json_result.images|length - 6 }} autres images</p>
                        {% endif %}
                    </div>
                </div>

                <!-- JSON complet -->
                <div class="card mb-3">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">📋 Données JSON</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-sm btn-outline-primary mb-2" onclick="copyJson()">
                            📋 Copier le JSON complet
                        </button>
                        <pre class="bg-light p-3 rounded small" id="jsonResult" style="max-height: 400px; overflow-y: auto;">{{ result.json_result | tojson_utf8 }}</pre>
                    </div>
                </div>
                {% else %}
                <div class="alert alert-warning">
                    Aucune image trouvée dans les résultats.
                </div>
                {% endif %}
                {% else %}
                <div class="alert alert-warning">
                    Aucun résultat JSON disponible.
                </div>
                {% endif %}

                <!-- Actions -->
                <div class="text-center mt-4">
                    <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
                        🔍 Nouvelle recherche
                    </a>
                    <a href="{{ url_for('menu') }}" class="btn btn-outline-info">
                        📋 Retour au menu
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function copyJson() {
    const jsonText = document.getElementById('jsonResult').innerText;
    navigator.clipboard.writeText(jsonText).then(() => {
        alert('✅ JSON copié dans le presse-papiers !');
    }).catch(err => {
        console.error('Erreur lors de la copie:', err);
        alert('❌ Erreur lors de la copie');
    });
}
</script>
{% endblock %}